# 工作记录任务列表功能增强 - 功能摘要

## 实现的功能

### 1. 任务状态筛选
- ✅ 在任务列表顶部添加了状态筛选器
- ✅ 支持待办、进行中、已完成、已取消四种状态的筛选
- ✅ 默认显示待办和进行中的任务
- ✅ 支持多选状态筛选
- ✅ 至少需要选择一个状态（防止空列表）
- ✅ 筛选器采用横向滚动布局，适配小屏幕

### 2. 任务排序
- ✅ 任务列表按创建时间倒序排序（最新创建的在前）
- ✅ Repository 层从 `ORDER BY updated_at DESC` 改为 `ORDER BY created_at DESC`

### 3. 工时显示
- ✅ 任务卡片显示已用工时和预计工时
- ✅ 格式：`1h/2h`（已用工时/预计工时）
- ✅ 如果没有预计工时，显示：`1h 已用`
- ✅ 自动将分钟转换为小时显示（如 90分钟 = 1.5h）

### 4. 左滑删除
- ✅ 任务卡片支持左滑删除操作
- ✅ 删除前显示确认对话框
- ✅ 级联删除任务关联的工时记录
- ✅ 保留操作日志（不删除）
- ✅ 删除背景为红色，带删除图标

## 技术实现

### Repository 层
- 新增 `getTotalMinutesForTask(int taskId)` 方法
- 更新 `listTasks()` 支持 `statuses` 参数（多状态筛选）
- 保持向后兼容，仍支持单个 `status` 参数
- 删除任务时自动级联删除工时记录（数据库外键约束）

### Service 层
- 新增 `statusFilters` 状态，默认为 `[todo, doing]`
- 新增 `getTaskTotalMinutes(int taskId)` 方法
- 新增 `setStatusFilters(List<WorkTaskStatus>)` 方法
- 加载任务时自动加载每个任务的总工时

### UI 层
- 新增 `_StatusFilterBar` 组件（状态筛选条）
- 新增 `_FilterChip` 组件（单个筛选按钮）
- 更新 `_TaskCard` 支持 Dismissible（左滑删除）
- 更新工时显示逻辑

## 测试覆盖

### 新增测试用例
1. ✅ 应该按创建时间倒序排列任务列表
2. ✅ 应该支持多状态筛选任务
3. ✅ 应该能计算任务的总工时
4. ✅ 删除任务应级联删除工时记录但保留操作日志

### 测试结果
- 所有测试通过（70个测试用例）
- 代码分析无警告
- 代码格式化符合规范

## UI 设计
- 遵循 iOS 26 设计风格
- 使用项目主题色（蓝色、橙色、绿色、灰色）
- 筛选器使用圆角卡片设计
- 选中状态带边框高亮
- 左滑删除背景为红色

## 向后兼容性
- ✅ Repository 接口保持向后兼容
- ✅ 现有代码无需修改
- ✅ 数据库无需迁移
